<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Milk Calendar Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .calendar-cell {
            transition: all 0.2s ease-in-out;
        }
        .calendar-cell:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .calendar-input {
            transition: all 0.15s ease-in-out;
        }
        .calendar-input:focus {
            transform: scale(1.02);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback } = React;

        const MonthlyMilkCalendar = () => {
          const [currentDate, setCurrentDate] = useState(new Date());
          const [dailyQuantities, setDailyQuantities] = useState({});
          const [editingCell, setEditingCell] = useState(null);
          const [editValue, setEditValue] = useState('');

          // Helper function to get days in month with proper grid layout
          const getDaysInMonth = useCallback((date) => {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
            
            const days = [];
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
              days.push(null);
            }
            
            // Add all days of the month
            for (let day = 1; day <= daysInMonth; day++) {
              days.push(day);
            }
            
            return days;
          }, []);

          // Generate a unique key for each date
          const getDateKey = (day) => {
            if (!day) return null;
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            return `${year}-${month}-${day}`;
          };

          // Handle cell click to start editing
          const handleCellClick = (day) => {
            if (!day) return;
            
            const dateKey = getDateKey(day);
            setEditingCell(dateKey);
            setEditValue(dailyQuantities[dateKey] || '');
          };

          // Save the edited value
          const saveValue = () => {
            if (editingCell && editValue.trim() !== '') {
              const numericValue = parseFloat(editValue);
              if (!isNaN(numericValue) && numericValue > 0) {
                setDailyQuantities(prev => ({
                  ...prev,
                  [editingCell]: numericValue
                }));
              }
            }
            setEditingCell(null);
            setEditValue('');
          };

          // Cancel editing
          const cancelEdit = () => {
            setEditingCell(null);
            setEditValue('');
          };

          // Handle key press in input field
          const handleKeyPress = (e) => {
            if (e.key === 'Enter') {
              saveValue();
            } else if (e.key === 'Escape') {
              cancelEdit();
            }
          };

          // Handle input blur
          const handleBlur = () => {
            saveValue();
          };

          // Navigate between months
          const navigateMonth = (direction) => {
            const newDate = new Date(currentDate);
            newDate.setMonth(newDate.getMonth() + direction);
            setCurrentDate(newDate);
          };

          const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];

          const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          const days = getDaysInMonth(currentDate);

          return (
            <div className="bg-white rounded-lg shadow-lg p-6 max-w-4xl mx-auto">
              {/* Header with month navigation */}
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-gray-900">Monthly Milk Delivery Calendar</h2>
                
                <div className="flex items-center space-x-4">
                  <button
                    onClick={() => navigateMonth(-1)}
                    className="p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors"
                  >
                    ← Previous
                  </button>
                  
                  <h3 className="text-lg font-semibold text-gray-900 min-w-[150px] text-center">
                    {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                  </h3>
                  
                  <button
                    onClick={() => navigateMonth(1)}
                    className="p-2 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors"
                  >
                    Next →
                  </button>
                </div>
              </div>

              {/* Instructions */}
              <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <p className="text-sm text-blue-800">
                  <span className="font-semibold">Instructions:</span> Click on any date cell to add or edit the milk quantity in liters. 
                  Press Enter or click outside to save, Escape to cancel.
                </p>
              </div>

              {/* Calendar Grid */}
              <div className="border border-gray-300 rounded-lg overflow-hidden">
                {/* Week day headers */}
                <div className="grid grid-cols-7 bg-gray-100">
                  {weekDays.map(day => (
                    <div key={day} className="p-3 text-center font-semibold text-gray-700 border-r border-gray-200 last:border-r-0">
                      {day}
                    </div>
                  ))}
                </div>

                {/* Calendar days */}
                <div className="grid grid-cols-7">
                  {days.map((day, index) => {
                    const dateKey = getDateKey(day);
                    const isEditing = editingCell === dateKey;
                    const quantity = dailyQuantities[dateKey];
                    const isEmptyCell = day === null;

                    return (
                      <div
                        key={index}
                        className={`min-h-[80px] border-b border-r border-gray-200 last:border-r-0 calendar-cell ${
                          isEmptyCell 
                            ? 'bg-gray-50' 
                            : 'bg-white hover:bg-gray-50 cursor-pointer'
                        }`}
                        onClick={() => !isEmptyCell && !isEditing && handleCellClick(day)}
                      >
                        {!isEmptyCell && (
                          <div className="h-full p-2 flex flex-col">
                            {/* Day number */}
                            <div className="text-sm font-medium text-gray-900 mb-2">
                              {day}
                            </div>

                            {/* Milk quantity display or input */}
                            <div className="flex-1 flex items-center justify-center">
                              {isEditing ? (
                                <div className="w-full">
                                  <input
                                    type="number"
                                    step="0.1"
                                    min="0"
                                    value={editValue}
                                    onChange={(e) => setEditValue(e.target.value)}
                                    onKeyDown={handleKeyPress}
                                    onBlur={handleBlur}
                                    placeholder="0.0"
                                    className="w-full p-1 text-sm border border-blue-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center calendar-input"
                                    autoFocus
                                  />
                                  <div className="text-xs text-gray-500 text-center mt-1">
                                    Press Enter to save
                                  </div>
                                </div>
                              ) : (
                                <div className="text-center">
                                  {quantity ? (
                                    <div>
                                      <div className="text-lg font-bold text-green-600">
                                        {quantity}L
                                      </div>
                                      <div className="text-xs text-gray-500 mt-1">
                                        Click to edit
                                      </div>
                                    </div>
                                  ) : (
                                    <div>
                                      <div className="text-sm text-gray-400">
                                        No delivery
                                      </div>
                                      <div className="text-xs text-gray-500 mt-1">
                                        Click to add
                                      </div>
                                    </div>
                                  )}
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Monthly Summary */}
              <div className="mt-6 grid grid-cols-3 gap-4 p-4 bg-green-50 rounded-lg">
                <div className="text-center">
                  <p className="text-sm text-green-600">Total Days with Delivery</p>
                  <p className="font-bold text-green-900">
                    {Object.keys(dailyQuantities).filter(key => {
                      const [year, month] = key.split('-').map(Number);
                      return year === currentDate.getFullYear() && month === currentDate.getMonth();
                    }).length}
                  </p>
                </div>
                <div className="text-center">
                  <p className="text-sm text-green-600">Total Monthly Quantity</p>
                  <p className="font-bold text-green-900">
                    {Object.entries(dailyQuantities)
                      .filter(([key]) => {
                        const [year, month] = key.split('-').map(Number);
                        return year === currentDate.getFullYear() && month === currentDate.getMonth();
                      })
                      .reduce((sum, [, quantity]) => sum + quantity, 0)
                      .toFixed(1)}L
                  </p>
                </div>
                <div className="text-center">
                  <p className="text-sm text-green-600">Average Daily Quantity</p>
                  <p className="font-bold text-green-900">
                    {(() => {
                      const currentMonthEntries = Object.entries(dailyQuantities)
                        .filter(([key]) => {
                          const [year, month] = key.split('-').map(Number);
                          return year === currentDate.getFullYear() && month === currentDate.getMonth();
                        });
                      const total = currentMonthEntries.reduce((sum, [, quantity]) => sum + quantity, 0);
                      const count = currentMonthEntries.length;
                      return count > 0 ? (total / count).toFixed(1) : '0.0';
                    })()}L
                  </p>
                </div>
              </div>
            </div>
          );
        };

        const App = () => {
          return (
            <div className="min-h-screen bg-gray-100 py-8">
              <div className="container mx-auto px-4">
                <h1 className="text-3xl font-bold text-center mb-8 text-gray-900">
                  Monthly Milk Calendar Demo
                </h1>
                <MonthlyMilkCalendar />
                
                <div className="mt-8 max-w-4xl mx-auto">
                  <div className="bg-white rounded-lg shadow-lg p-6">
                    <h2 className="text-xl font-semibold mb-4 text-gray-900">Features:</h2>
                    <ul className="space-y-2 text-gray-700">
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Click on any date cell to add or edit milk quantity</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Press Enter or click outside to save changes</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Press Escape to cancel editing</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Navigate between months using Previous/Next buttons</span>
                      </li>
                      <li className="flex items-center space-x-2">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>View monthly statistics at the bottom</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>